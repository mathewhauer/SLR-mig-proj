---
title: | 
  Demographic change and migration due to sea-level rise in the United States

# to produce blinded version set to 1
blinded: 0

authors: 
- name: Mathew E. Hauer
  thanks:  Thanks y'all!
  affiliation: Department of Sociology, Florida State University
  
- name: Sunshine Jacobs
  affiliation: Department of Sociology, Florida State University
  
- name: Scott Kulp
  affiliation: Climate Central

keywords:
- Climate Change
- Human Migration
- Demography
- Multiregional population projections
- Sea-level rise

abstract: The warnings of sea-level rise (SLR) driven migration first appeared in the scientific literature in the late 1970s when increased recognition that disintegrating ice sheets could drive people to migrate from coastal cities. Since that time, scientists have modelled potential SLR driven migration without integrating other population processes, potentially obscuring the total demographic impact of SLR migration. If sea-level rise forces millions of people further inland, a potential domino effect could result, further enhancing migration to more distant locations and further suppressing migration to coastal areas. Furthermore, older populations are the least likely to migrate and SLR migration could accelerate population aging in coastal areas. Here, we investigate both the potential domino effect of SLR migration and the potential emergence of "demographically stuck" populations by combining matrix population models, flood hazard models, and a machine learning model built on 40 years of environmental migration in the US to project the US population distribution of US counties, accounting for anticipated demographic change, migration probabilities, and sea-level rise. We find that the total demographic impact of 0.9m of SLR in 2100 is nearly 13 million people -- four times the number of migrants. We project a significant "hollowing" of coastal age structures as youthful populations migrate out but older populations remain. The potential for "demographically stuck" populations has received scant attention but could occur in heavily impacted areas. Furthermore, our population projection approach can be easily adapted to investigate additional or multiple climate hazards.

# The warnings of sea-level rise driven migration first appeared in the scientific literature in the late 1970s when increased recognition that disintegrating ice sheets could drive people to migrate from coastal cities.  Previous attempts to model this potential sea-level rise driven migration eschew two important considerations. First, sea-level rise migration models lack the crucial feedback loop whereby sea-level rise migrants alter the demographic trajectory in both their origin and destination. If sea-level rise forces millions of people further inland, a potential domino effect could result, further enhancing migration to more distant locations and further suppressing migration to coastal areas. Second, modelers have chosen to model migrants as age-less and sex-less individuals, overlooking well-established relationships between migration propensity and demographic characteristics. Here, we combine demographic models, flood hazard models, and a machine learning model built on 40 years of environmental migration in the US to project the US population distribution of US counties, accounting for anticipated demographic change, migration probabilities, and sea-level rise. Our results suggest that the demographic implications of climate migration go far beyond simple displacement estimates, as population momentum from climate migrants multiplies the demographic effects in both origin and destination areas.
  
bibliography: mybibfile
output: rticles::asa_article
# csl: LATEX/demography.csl
header-includes:
  - \usepackage{amsmath}
  - \usepackage{amsfonts}
  - \usepackage{booktabs}
  - \usepackage{makecell}
  - \usepackage[usenames, dvipsnames]{color}
  - \usepackage{multirow}
  - \usepackage{comment}
  - \usepackage{booktabs}
  - \usepackage{longtable}
  - \usepackage{array}
  - \usepackage{wrapfig}
  - \usepackage{float}
  - \usepackage{colortbl}
  - \usepackage{pdflscape}
  - \usepackage{tabu}
  - \usepackage{threeparttable}
  - \usepackage{threeparttablex}
  - \usepackage[normalem]{ulem}
  - \usepackage{xcolor}
  - \newcommand{\beginsupplement}{\setcounter{table}{0} \renewcommand{\thetable}{S\arabic{table}}\setcounter{figure}{0} \renewcommand{\thefigure}{S\arabic{figure}}}
---

\newpage

```{r setup, include=FALSE}
rm( list=ls() )
knitr::opts_chunk$set(echo  = TRUE)
knitr::opts_chunk$set(dev = c("pdf", "png"))
# knitr::opts_chunk$set(cache = TRUE)
# read_chunk loads script files and
# creates labels so that they can be 
# used later in the program
#
# each script file starts with a line
# like 
#   ## @knitr libraries
# that creates a label matching the
# script's filename
library(knitr)
read_chunk('../R/SCRIPTS/000-Libraries.R')
read_chunk('../R/SCRIPTS/101-Figure1ProjLines.R')
read_chunk('../R/SCRIPTS/103-FigureAging.R')
```

```{r libraries, include=FALSE}
```

```{r , include =FALSE}
fipslist <- read_csv(file="https://www2.census.gov/geo/docs/reference/codes/files/national_county.txt", col_names = FALSE) %>%
  mutate(GEOID = paste0(X2, X3)) %>%
  dplyr::rename(state = X1,
                STATEID = X2,
                CNTYID = X3,
                NAME = X4) %>%
  filter(!STATEID %in% c("60", "66", "69", "72", "74", "78")) # filtering out the outerlying areas.

popdrops <- read_csv("../R/DATA-PROCESSED/anomaliesdat.csv")
a <- popdrops %>%  
  filter(time >= 1980,
         perdrop <1) %>%
  left_join(., fipslist)
```

# Introduction

Scientists first sounded the alarm of potential "major dislocations in coastal cities" [@mercerWestAntarcticIce1978] due to a disintegrating West Antarctic Ice Sheet and sea-level rise more than forty years ago. Since those early warnings, experts continue to regard sea-level rise as one of the most costly and visible future impacts of global climate [@mcgranahanRisingTideAssessing2007; @nichollsSeaLevelRiseIts2010; @straussCarbonChoicesDetermine2015]. With the global coastal population projected to eclipse one billion people this century [@neumannFutureCoastalPopulation2015], sea-level rise is expected to affect and, in many cases, displace hundreds of millions of people [@hauerMigrationInducedSealevel2017; @nichollsSeaLevelRiseIts2010].

While the scientific community understands that climate change and sea-level rise will affect millions of people in the United States and across the world, we face a critical knowledge gap about the impacts of rising sea levels on human migration. Previous attempts to model sea-level rise and migration eschew two key considerations. First, sea-level rise migration models lack the crucial feedback loop whereby sea-level rise migrants alter the demographic trajectory in both their origin and destination. If sea-level rise forces millions of people further inland, a potential domino effect could result, further enhancing migration to more distant locations and further suppressing migration to coastal areas [@curtisUnderstandingDemographicImplications2011; @doosCanLargescaleEnvironmental1997a; @hauer2020sea].

Second, modelers have chosen to model migrants as age-less and sex-less individuals [@hauerMigrationInducedSealevel2017; @mcgranahanRisingTideAssessing2007; @neumannFutureCoastalPopulation2015; @straussCarbonChoicesDetermine2015], ignoring the well-established relationship between migration propensity and demographic characteristics [@blackClimateChangeMigration2011; @clarkInterpretingMigrationPrism2015; @de2019direct; @dielemanModellingResidentialMobility2001]. This demographic oversight could be due to the relative youthful research on the topic, a lack of sophisticated demographic modeling, the relative paucity of demographic and migration data in most of the world, or any combination of these factors. Regardless, this demographic ignorance is paramount given the demographic shifts anticipated this century [@colby2017projections]. Those with the least resources are least likely to migrate when facing environmental pressures [@blackClimateChangeMigration2011]. By ignoring these well-established relationships, past sea-level rise migration models likely overestimate those most likely to migrate and grossly underestimate those who might be "trapped" in coastal communities. These gaps combine to create divergent estimates of who will be most affected and how sea-level rise will ultimately alter population distributions. The challenge is to develop better coupled natural-human systems for assessing sea-level rise impacts that properly couple climate projections with projections of demographic change.

This paper combines matrix population models, flood hazard models, and a machine learning model built on 40 years of environmental migration to project counties' population distribution in the United States, accounting for anticipated demographic change, migration probabilities, and sea-level rise.  We ask the two fundamental research questions: To what extent will sea-level rise migration alter the distribution of the demographic trajectory of the US population? And How might changes in future age structures alter migration dynamics for those impacted by sea-level rise? In addressing these questions, this project answers the Intergovernmental Panel on Climate Change's (IPCC) call to "construct impact assessments in which biophysical futures are coupled with socioeconomic futures"[^1].

[^1]: IPCC Fifth Assessment Report, p.213.

# Background and Overview

The implications of sea-level rise on human migration first appeared in the scientific literature more than forty years ago [@mercerWestAntarcticIce1978; @schneiderCarbonDioxideWarming1980], when scientists started to sound the alarm of a disintegrating West Antarctic Ice Sheet and the potential "major dislocations in coastal cities" [@mercerWestAntarcticIce1978]. Since those early warnings, sea-level rise and associated impacts continue to be widely regarded as one of the most costly and irreversible future consequences of global climate change [@intergovernmental2019special]. Scientific projections of global mean sea-level rise for the year 2100 range from a low of 0.4 meters to a high of 2.5 meters [@jevrejevaSeaLevelProjections2012; @sweetGlobalRegionalSea2017], depending on assumptions of future anthropogenic greenhouse gas emission levels, thermal expansion of ocean masses, sea surface temperatures, rates of melting and decomposition of Antarctic and Greenland ice sheets, and isostatic adjustment as large ice sheets disappear. These sea-level rise projections are likely conservative and high-end sea-level rise is increasingly realistic [@bamber2019ice]. With the global coastal population projected to eclipse one billion people this century [@neumannFutureCoastalPopulation2015], sea-level rise is expected to affect and, in many cases, displace hundreds of millions of people [@hauer2020sea].

Since the first studies to quantify population displacement due to sea-level rise and document changes in human migration related to sea-level rise, fundamental understanding of sea-level rise and human migration has rapidly advanced with the development of basic theory on climate change migration [@blackClimateChangeMigration2011], empirical case studies of historical analogs for future sea-level rise (e.g. @arenstamgibbonsIslandAbandonmentSealevel2006, @baileyComplexitiesResilienceAdaptation2014, @trincardi1966FloodingVenice2016), integrated economic analysis and modeling of sea-level rise retreat [@yohe1998sea], explicit models of sea-level rise migration [@hauerMigrationInducedSealevel2017; @chen2018coastal], as well as contentious policy discussions on the need for coastal retreat and adaptive infrastructure [@hinoManagedRetreatResponse2017]. In some cases, studies even question *if* sea-level rise will spur widespread migration at all [@knivetonSealevelriseImpactsQuestioning2017; @lauricejameroSmallislandCommunitiesPhilippines2017].

Sea-level rise influences human migration in multiple ways. The most straightforward, apparent, and existential migration pressure involves permanent, irreversible inundation of low-elevation areas, under which a specific rise in sea level renders the built environment uninhabitable [@hauerMillionsProjectedBe2016; @poulterRasterModellingCoastal2008]. Migration is widely understood as a choice in which individuals weigh the economic, social, and emotional costs and benefits of moving [@blackClimateChangeMigration2011]. Thus, the decision to migrate is multidimensional [@clarkInterpretingMigrationPrism2015].

Most sea-level rise migration studies only model migration along environmental factors [@davisUniversalModelPredicting2018; @nichollsSeaLevelRiseIts2010], or couple environmental factors with economic [@chen2018coastal] or social factors [@robinson2020modeling]. Conspicuously missing from these models is the integration of demographic factors. This omission is particularly egregious given the availability of high-quality demographic data in the United States and the relative simplicity of integrating demographic change into migration models.

Despite these rapid advancements, the clear significance of this dimension of global environmental change in the US, the lively debate surrounding the topic, and the variety of perspectives and methodologies offered in the literature, several scientific challenges remain. Notably, a fully integrated, dynamic demographic/sea-level rise model.

This paper fills this gap by incorporating migration modeling within a demographic change model called the Demographic Metabolism [@lutz2017forecasting; @ryder1985cohort]. To answer our research questions, we employ two main modules. The first is the development of a parsimonious, one-dimensional, age-specific displacement model. The second is a multiregional Leslie matrix specification.

# Methods and Materials

To answer our research questions, we employ three main modules. The first is the development of a parsimonious, one-dimensional, age-specific displacement model. The second is a multiregional Leslie matrix specification. The third is a sea-level rise exposure model.

## A parsimonious one-dimensional, age-specific displacement model

Our displacement model makes use of a statistical time series outlier detection technique to first identify anomalous demographic behavior in a time series and then verify that this anomalous behavior is associated with an environmental event. In the following sections, we describe this algorithm, the data sources we use, and finally the devleopment of the displacement model itself.

### Statistical Outlier Detection

We use a statistical time series outlier detection algorithm [@chen1993joint], implemented in the R programming language [@rcore] via the tsoutliers package [@tsoutliers2019]. This algorithm iteratively uses ARIMA models to 1) identify potential outliers and 2) refit the ARIMA with the outliers removed to produce a counter-factual time series. Here we briefly summarize and describe the method.

Often, the behavior of a time series can be described and summarized in ARIMA models. If a series of values, $y_t^*$, is subject to $m$ interventions or outliers at time points $t_1,t_2,…,t_m$ with weights $\omega$ then $y_t^*$ can be defined as


\begin{equation}
\label{eq:arima}
y_t^* = \sum_{j=1}^{m} \omega_jL_j(B)I_t(t_j) + \frac{\theta(B)}{\phi(B)\alpha(B)}a_t 
\end{equation}

Where $I_t(t_j)$ is an indicator variable with a value of 1 at observation $t_j$ and where the $j$th outlier arises,\
$\phi(B)$ is an autoregressive polynomial with all roots outside the unit circle,\
$\theta(B)$ is a moving average polynomial with all roots outside the unit circle,\
and $\alpha(B)$ is an autoregressive polynomial with all roots on the unit circle.

We examine three types of outliers at time point $t_m$:\
1. additive outliers (AO), defined as $L_j(B)=1$;\
2. level shift outliers (LS), defined as $L_j(B) = 1/(1-B)$; and\
3. temporary change outliers (TC), defined as $L_j(B) = 1/(1-\delta B)$ where $\delta$ is equal to 0.7.

Colloquially, additive outliers arise when a single event causes the time series to unexpectedly increase/decrease for a single time period; level shift outliers emerge when an event causes the time series to unexpectedly increase/decrease for multiple time periods; and temporary change outliers arise when an event causes the time series to unexpectedly increase/decrease with lingering effects that decay over multiple time periods.

An outlier is detected with the estimated residuals using a regression equation

\begin{equation}
\label{eq:residuals}
\pi(B)y_t^* \equiv \hat{e} = \sum_{j=1}^m \omega_j \pi(B)L_j(B)I_t(t_j) + a_t
\end{equation} 
where $\pi(B)=\sum_{i=o}^{inf} \pi_iB^i$.

Equations \ref{eq:arima} and \ref{eq:residuals} allow for an automatic detection of outliers iterated over a two-stage process.

In stage 1, our algorithm locates outliers. First, an ARIMA model is fit to the time series using the `forecast` package in R [@Rforecast; @hymdman2008] where the best performing ARIMA model is selected based on the Bayesian information criterion (BIC). Next, the residuals from the forecast are checked for their significance using equation \ref{eq:residuals} where only outliers above a critical *t*-static are considered "true" outliers ($|\tau| \geq 4$; p-value \< 0.000063). We chose this threshold to minimize the probability of committing a Type I error (or claiming an outlier is true when it is, in fact, not). Finally, We implement two additional rules: If the algorithm detects multiple outliers at the same time point, it selects the most significant outlier, and if outliers of the same type at consecutive time periods are detected, only the outlier with the highest *t*-statistic is selected.

In stage 2, we design the algorithm to remove outliers from the time series and choose and fit a new ARIMA model. However, the selection of the initial ARIMA model may be affected by the presence of the outliers, making some outliers spuriously identified. To correct for this, a new ARIMA model is fit accounting for additional regression effects in equation \ref{eq:arima} from the list of candidate outliers identified in stage 1, effectively removing the outliers from the time series. The algorithm then reassesses each outlier under the new model and removes those outliers that are no longer significant.

The model iterates these two stages until no additional outliers are detected.

```{r, include = FALSE }
set.seed(1)

# download.file("https://seer.cancer.gov/popdata/yr1969_2019.19ages/la.1969_2019.19ages.txt.gz", "../R/DATA-RAW/la.1969_2019.19ages.txt.gz")
# ## UNZIPPING THE DATA FILE
# gunzip("../R/DATA-RAW/la.1969_2019.19ages.txt.gz", overwrite = TRUE, remove = TRUE)

K05_pop<- read.table("../R/DATA-RAW/la.1969_2019.19ages.txt") 
K05_pop$V1 <- as.character(K05_pop$V1) # SETTING THE ENTIRE SINGLE VARIABLE INTO A CHARACTER
K05_pop$YEAR <- as.numeric(substr(K05_pop$V1,1,4)) # SEPARATING THE YEAR AND SETTING IT AS A NUMBER
K05_pop$STATEID <- substr(K05_pop$V1, 5,6) # SEPARATING THE 2 CHARACTER STATE ABBREVIATION
K05_pop$STATE <- substr(K05_pop$V1, 7,8) # SEPARATING THE 2-DIGIT STATE CODE
K05_pop$COUNTY <- substr(K05_pop$V1,9,11) # SEPARATING THE 3-DIGIT COUNTY CODE
K05_pop$REGISTRY <- substr(K05_pop$V1, 12,12) # REGISTRY IS A THROW AWAY VARIABLE REFERING TO ODD GEOGRAPHIES
K05_pop$RACE <- substr(K05_pop$V1, 14,14) # SEPARATING OUT THE RACE CODES.
K05_pop$ORIGIN <- substr(K05_pop$V1, 15,15) # SEPARATING OUT HISPANIC ORIGIN. THIS VARIABLE IS NOT APPLICABLE IN THE 1969-2016 DATA
K05_pop$SEX <- substr(K05_pop$V1, 16,16) # SEPARATING OUT THE SEX DATA
K05_pop$POPULATION <- as.numeric(substr(K05_pop$V1, 19, 30)) # SEPARATING THE ACTUAL POPULATION ESTIMATES.

# Setting the groupings
GROUPING <- c("STATE", "COUNTY", "YEAR")

K05_pop <- K05_pop %>%
  group_by(.dots = GROUPING) %>%
  dplyr::summarise(POPULATION = sum(POPULATION))

start <- 1980
K05_pop$GEOID <- paste0(K05_pop$STATE, K05_pop$COUNTY) # SETTING THE 5-DIGIT FIPS CODE
K05_pop2 <- filter(K05_pop, GEOID == "22071",
                  YEAR >= start)

dat3 <- ts(K05_pop2$POPULATION)
a<- tsoutliers::tso(dat3,types = c("AO","LS","TC"))


K05_pop2$label = ifelse(K05_pop2$YEAR == 2006, "Anomaly Detected\n t = -96.4", "")

b <- as.data.frame(forecast(auto.arima(K05_pop2$POPULATION[1:26]), h=14)) %>%
  mutate(YEAR = seq(2006, 2019,1)) %>%
  dplyr::select(Point.Forecast = `Point Forecast`, YEAR)

b<- rbind(b, data.frame(YEAR = 2005, `Point Forecast` = 494294))

```

```{r ToyExample, echo= FALSE, message = FALSE, warning = FALSE, fig.cap= paste("\\textbf{An example of outlier detection using Hurricanes Katrina and Rita in Orleans Parish Louisiana in 2005.} Hurricane Katrina struck Louisiana in 2005 and we use it as a toy example to illustrate our approach. This figure shows the annual time series of total population in Orleans Parish between 1980 and 2019. Between 1990 and 2005, Orleans Parish total population changed from 495k to 494k, suggesting a possible 'plateau' in the population (illustrated with the dotted 'counterfactual'). Hurricane Katrina and the widespread population loss of more than 200k people represent a very strong outlier (t=-96.39). \\label{explanationfigure}")}

ggplot(data = K05_pop2, aes( x = YEAR, y = POPULATION)) +
  geom_line() +
  geom_point(data = K05_pop2[which(K05_pop2$label == "Anomaly Detected\n t = -96.4"),], aes(size=2), shape=1) + 
  geom_line(data = b, aes(y = Point.Forecast, x=YEAR), linetype=2) +
  scale_y_continuous(label=comma) +
  geom_label_repel(aes(label = label),
                   box.padding   = 0.4, 
                   point.padding = 0.6,
                   segment.color = 'grey50') +
  annotate(geom='text', x=2021, y=500000, label=TeX("Counterfactual estimate, $\\hat{y}$", output='character'), parse=TRUE, hjust = 0) +
  annotate(geom='text', x=2021, y=390000, label=TeX("Observed data, $y$", output='character'), parse=TRUE, hjust = 0) +
  scale_x_continuous(breaks = seq(1980, 2020, 10), limits = c(1980,2040), expand= c(0,0)) +
   scale_y_continuous(label=comma, limits=c(0, 565000), breaks = seq(0,570000,100000)) +
  coord_capped_cart(bottom='right') +
  theme_classic() +
  theme(legend.position = "none")+
  labs(x = "Year",
       y = "Total Population")

```

\autoref{explanationfigure} shows a toy example for outlier detection in a time series using the example of Hurricane Katrina in Orleans Parish. On August 23 2005, Hurricane Katrina, a category 5 hurricane, struck southern Louisiana, causing widespread damage and destruction in Orleans Parish in particular. The displacement from the Hurricane and the federal response were well documented [@horiDisplacementDynamicsSouthern2009; @fussellRecoveryMigrationCity2014], and Census estimates suggest Orleans Parish lost more than 200,000 residents between 2005 and 2006. What would have been Orleans' population estimate had Hurricane Katrina *not* occurred? A simple counter-factual estimate might keep population size just under 500,000 people ($\hat{y}$).

In the Hurricane Katrina example, we have knowledge of the impact of Hurricane Katrina after the fact or ex-post-facto in order to create the counter-factual time series $\hat{y}$. But is this outlier detectable without knowledge of the Hurricane Katrina? In other words, can we detect the reduction of Orleans Parish's population between 2005 and 2006 using only the time series? Absolutely. The tsoutliers package identifies 2006 as an extremely strong level-shift outlier (*t*-stat = `r round( a$outliers$tstat[1], digits = 2)`).

### Data

For the development of our parsimonious, one-dimensional displacement model, we use two primary datasets: the National Vital Statistics System (NVSS) U.S. Census Populations with Bridged Race Categories data set[^2] and the Spatial Hazard Events and Losses Database for the United States (SHELDUS).

[^2]: Data can be downloaded here: <https://seer.cancer.gov/popdata/download.html>

The NVSS Bridged Race Categories data set harmonizes racial classifications across disparate time periods to allow population estimates to be sufficiently comparable across space and time. Importantly, all county boundaries are rectified to be geographically consistent across all time periods. We use the the 1969-2018 dataset, which includes annual population estimates in five year age groups (0-4,..., 85+), two sex groups (male and female), and three race groups (White, Black, Other).

Our statistical outlier analysis (detailed below) only considers counties created prior to 2000 and contained in the NVSS data.  NVSS aggregated all counties in Hawaii to the state-level in the 1969-2018 NVSS bridged race data, and we exclude them from our analysis. Several counties were created after 2000 (most notable is Broomfield County, Colorado). The 15 counties excluded from our analysis due to boundary changes or other reasons are Hoonah-Angoon Census Area AK 02105, Kusilvak Census Area AK 02158, Prince of Wales-Outer Ketchikan Census Area AK 02201, Skagway-Hoonah-Angoon Census Area AK 02232, Wrangell-Petersburg Census Area AK 02280, Adams County CO 08001, Boulder County CO 08013, Broomfield County CO 08014, Jefferson County CO 08059, Weld County CO 08123, Hawaii County HI 15001, Honolulu County HI 15003, Kalawao County HI 15005, Kauai County HI 15007, and Maui County HI 15009.

We use these data in two separate steps. First, in our statistical outlier analysis, we aggregate all county-level estimates into annual total population estimates for each county for the period 1969-2018. The historical population estimates prior to 1980 display unusual volatility, so we consider only the time periods 1980-2018. Then we use the NVSS population estimates disaggregated by age/sex to calculate cohort-change ratios, which we describe below.

The second data source we use is SHELDUS. SHELDUS is a county-level hazard data set for the US which contains information about the direct losses (property and crop losses, injuries, and fatalities) caused by a hazard event (thuderstorms, hurricanes, floods, wildfires, tornados, flash floods, earthquakes, etc.) for the period 1960 to the present. We use this database to ensure the county time periods we identify as statistical outliers with population losses experienced an environmental hazard in that county-year. This is to ensure the outlier population losses that we detect are associated with a hazard rather than other forces, such as economic forces.

### Development of the Displacement Model

We search all US counties for negative statistical outliers (indicating population losses) between 1980 and 2018. We detect `r nrow(a)-1` population losses of magnitude 4$\sigma$ or greater. We then searched the SHELDUS database to see if these county-years experienced per capita hazardous losses in excess of the 50th percentile. Four county-periods either were not in the SHELDUS database or experienced per capita hazard losses below the 50th percentile. Additionally, one county-period contained age-sex groups with 0 people, necessitating exclusion. These 48 environmental events include tornados, wind damage, winter weather, earthquakes, flooding, tropical cyclones, hail, and other environmental hazards.

With 48 county-periods exhibiting large population declines after verified hazard losses, across over 40 years and across a wide variety of environmental hazards, we can overcome a common limitation in environmental migration modeling: that of isolated case studies of individual environmental events. This large sample of environmental displacement also overcomes a second limitation common in environmental migration modeling: that of only examining the total population. To investigate environmental migration across age, we build a flexible, one-dimensional, age-specific displacement model.

To link population displacement with age-specific population changes, we calculate cohort-change ratios in each county. Using the demographic accounting equation, the population at some time period *t* is equal to the $Pop_{t-1} + Births_{t-1} - Deaths_{t-1} + Migrants_{{t-1},in} - Migrants_{{t-1},out}$. For all age groups older than 0, $Births_{t-1}$ must be 0.

The calculation of a cohort-change ratio, as its name suggests, is relatively straightforward:

$$ 
CCR_{x,t}  =  \frac {_nP_{x,t}} {_nP_{x-y,t-y}}
$$

Where $_nP_{x,t}$ is the population aged $x$ to $x+n$ in time $t$ and $_nP_{x-y,t}$ is the population aged $x-y$ to $x+n-y$ in time $t$ where $y$ refers to the time difference between time periods. Since mortality must decrement a population, any CCR above 1.0 implies a net-migration rate in excess of the mortality rate, and a growing population.

We build the following model based on the relationship between the change in CCRs at age $x$, $\Delta CCR_x = CCR_{x,t} / CCR_{x,t-1}$, and the percentage decline in the total population compared to the counter-factual in the outlier detection method, $\Delta P_t = \hat{P_t} / P_t$:

$$
log(\Delta CCR_x) = a_x + b_xh
$$

Here, $h$ is the log($\Delta P_t$) and shows a linear relationship with the logarithm of the change in CCRs by age. $x$ refers to five-year age groups: 0-4, 5-9,..., 85+. This is a similar model and approach to Wilmoth et al.'s [-@wilmoth2012flexible] flexible, one-dimensional mortality model based on the linearity between age-specific mortality rates and infant mortality. **Table 1** depicts the correlation coefficients between log($\Delta CCR_x$) and log($\Delta P_t$). The age groups with the lowest correlation coefficients are young adult males aged 20-39 and those in the open-ended age interval (80+), suggesting these age/sex groups react to environmental signals the least predictably.

```{r correltable, echo=FALSE, results='asis', message=FALSE, warning=FALSE, }
coeffs <- read_csv("../R/DATA-PROCESSED/modelcoeffs.csv")

correlationcoeffs <- coeffs %>% dplyr::select(groups, rsq, sex) %>%
  mutate(sex = case_when(sex == 1 ~ "Male", sex==2 ~ "Female"),
         `Age Group` = case_when(
           groups == "ccr1" ~ "0-4",
           groups == "ccr2" ~ "5-9",
           groups == "ccr3" ~ "10-14",
           groups == "ccr4" ~ "15-19",
           groups == "ccr5" ~ "20-24",
           groups == "ccr6" ~ "25-29",
           groups == "ccr7" ~ "30-34",
           groups == "ccr8" ~ "35-39",
           groups == "ccr9" ~ "40-44",
           groups == "ccr10" ~ "45-49",
           groups == "ccr11" ~ "50-54",
           groups == "ccr12" ~ "55-59",
           groups == "ccr13" ~ "60-64",
           groups == "ccr14" ~ "65-69",
           groups == "ccr15" ~ "70-74",
           groups == "ccr16" ~ "75-79",
           groups == "ccr17" ~ "80+",
         )) %>%
  pivot_wider(names_from = sex, values_from= rsq) %>%
  dplyr::select(-groups)

kable(correlationcoeffs, "latex", booktabs = T, caption="\\textbf{Correlation coefficients of changes in Cohort Change Ratios vs. Total Population Change (n=48).}", digits = 3)
```

\autoref{CCRfig} shows the relationship for selected age-groups between log($\Delta CCR_x$) and log($\Delta P_t$). Here we can see the near linear relationship between the percentage reduction in the population and the percentage reduction in $CCR_x$. Note the two county-years with the greatest reductions in total population refer to Louisiana counties most impacted by Hurricane Katrina.

```{r CCRfig, echo= FALSE, message = FALSE, warning = FALSE, fig.cap= paste("\\textbf{Age-specific changes in cohort-change ratios ($\\Delta CCR_x$) vs. change in total population ($\\Delta P_t$).}  \\label{CCRfig}")}

CCRs3 <- read_csv("../R/DATA-PROCESSED/CCRs.csv")
makemultiplot <- function(i, title){

z <- filter(CCRs3, groups == paste0("ccr",i)) # filtering to age group i and men
# SEX == 1)  
a<-data.frame(y =z$testval, x=z$perdrop)
ggplot(data=a, aes(x= x, y =y)) +
  geom_point() +
  stat_smooth(method = "lm", formula = y ~ x) +
  theme_bw() +
  xlim(0,1) +
  ylim(0,1) +
  labs(x = "% Change in Population",
       y = "% Change in CCR",
       title = paste0(title))
# return(a_1)
}
a_1 <- makemultiplot(1, "Age 0-4") +
  theme(axis.title.x=element_blank(),
        # axis.text.x=element_blank(),
        # axis.ticks.x=element_blank(),
        axis.title.y=element_blank())
a_2 <- makemultiplot(4, "Age 15-19") +
  theme(axis.title.x=element_blank(),
        # axis.text.x=element_blank(),
        # axis.ticks.x=element_blank(),
        axis.title.y=element_blank())
a_3 <- makemultiplot(7, "Age 30-34") +
  theme(axis.title.x=element_blank(),
        # axis.text.x=element_blank(),
        # axis.ticks.x=element_blank()
        )
a_4 <- makemultiplot(10, "Age 45-49") +
  theme(axis.title.x=element_blank(),
        # axis.text.x=element_blank(),
        # axis.ticks.x=element_blank(),
        axis.title.y=element_blank())
a_5 <- makemultiplot(13, "Age 60-64") +
theme(axis.title.y=element_blank())
a_6 <- makemultiplot(17, "Age 80+") +
  theme(axis.title.y=element_blank())

plot_grid(a_1, a_2, a_3, a_4, a_5, a_6,
          ncol=2, align = "hv")
```

### Environmental Migration estimation using the fitted model

Using $h=log(\Delta P_t)$, we can estimate age-specific changes in CCRs after an environmental event by simply applying the following formula:


\begin{equation}
\hat{CCR_{x,t}} = CCR_{x,t-1} \cdot e^{\hat\beta_xh} \label{eq:predCCR}
\end{equation}


Where $e^{\hat\beta_xh}$ provides the percentage change in $CCR_x$ based on the log($\Delta{P_t}$).In this case, we drop the intercept ($a$) from the estimation procedure to ensure a 0% decline in population yields a corresponding 0% change in the CCR. We are simply multiplying the result from the model with the CCR in the year prior yields the anticipated change in the CCR. These changes in CCRs can then be applied to any time series of population values to generate an anticipated population.

```{r evalfig, echo= FALSE, message = FALSE, warning = FALSE, fig.cap= paste("\\textbf{Relationship between predicted populations using our model and observed populations in the 48 counties in our selection.} (a) shows the total population and (b) shows the populations for each age/sex group. The diagonal solid line is y=x. The model produces good fits for both the total population and by age/sex group.  \\label{EvalFig}") }

CCRs5 <- read_csv("../R/DATA-PROCESSED/CCR_evaluation.csv")

summarystats <- CCRs5 %>%
  group_by(GEOID, YEAR) %>%
  dplyr::summarise(POPULATION = sum(POPULATION),
                   predPop = sum(predPop)) %>%
  mutate(diff = predPop - POPULATION,
         perdiff = diff / POPULATION)

rsqa <- round(cor(summarystats$POPULATION, summarystats$predPop)^2, digits = 3)
rsqb <- round(cor(CCRs5$POPULATION, CCRs5$predPop)^2, digits = 3)

a<-ggplot(summarystats, aes(x = POPULATION, y = predPop)) +
  geom_point() +
  theme_bw() +
  geom_abline(slope=1) +
  scale_x_continuous(trans='log2', label = comma) +
  scale_y_continuous(trans='log2', label = comma) +
  annotate("text",x = min(summarystats$predPop)*5, y =max(summarystats$POPULATION),
           label = paste0("r^{2}==",rsqa), parse = TRUE) +
  labs(x = "Observed Population",
       y = "Predicted Population",
       title = "Total Population",
       caption = "n=48")

b<-ggplot(CCRs5, aes(x = POPULATION, y = predPop)) +
  # geom_point(aes(x = CCR, y = predCCR), alpha = 1/10) +
  geom_point(alpha = 1/10) +
  theme_bw() +
  geom_abline(slope=1) +
  scale_x_continuous(trans='log2', label = comma) +
  scale_y_continuous(trans='log2', label = comma) +
  annotate("text",x = min(CCRs5$predPop)*10, y =max(CCRs5$POPULATION),
           label = paste0("r^{2}==",rsqb), parse = TRUE) +
  labs(x = "Observed Population",
       y = "Predicted Population",
       title = "Population by age-group",
       caption = "n=1,630")

plot_grid(a,b, ncol=2, labels = "auto")

```

\autoref{EvalFig} shows the accuracy of our fitted, one-dimensional model. We estimate the predicted population using the equation outlined above and then compare it against the observed population. Regarding the total population in our 48 counties, our model performs well with an $r^2$ value of 0.994 and performs well regardless of population size. Regarding each individual $P_x$ group, our model performs slightly worse but still performs quite well with an $r^2$ of 0.976. Just like with the total population, the accuracy of our model does not depend on population size.

## Matrix Population Models

We employ the use of multiregional leslie matrices in our population projections [@rogers1966multiregional]. To illustrate our leslie matrix and projection specification, we use an example of a three-age group, two region population.

In a typical Leslie matrix,


\begin{equation}
    \mathbf{P_{t+1}} = \mathbf{S_t} \cdot \mathbf{P_t} \label{eq:lesliematrix_base}
\end{equation}

Where $\mathbf{P_t}$ refers to the population matrix containing $k$ age groups and $\mathbf{S_t}$ contains the age-specific fertility and mortality rates.

Thus, to produce a population projection, the operation looks akin to


\begin{equation}
\begin{bmatrix}
    0 & F_2 & F_3 \\
    S_1 & 0 & 0 \\
    0 & S_2 & S_3
\end{bmatrix}
\cdot
\begin{bmatrix}
    P_1 \\
    P_2 \\
    P_3
\end{bmatrix}
=
\begin{bmatrix}
    0 & 0.2 & 0.2 \\
    0.62 & 0 & 0 \\
    0 & 0.35 & 0.35
\end{bmatrix}
\cdot
\begin{bmatrix}
    100 \\
    100 \\
    100
\end{bmatrix}
=
\begin{bmatrix}
    40 \\
    68 \\
    71
\end{bmatrix}
\end{equation}

In a multi-regional projection model, we can use a "super-matrix."

A 2-region model would take the following general form for the $\mathbf{S_t}$ matrix,


\begin{equation}
 \mathbf{MS_{t+1}} =
\begin{bmatrix}
\begin{array}{c|c}

\mathbf{S_i} & \mathbf{M_{j\rightarrow i}} \\
\hline
\mathbf{M_{i\rightarrow j}} & \mathbf{S_j} \\

\end{array}
\end{bmatrix}
\end{equation}

Such that the diagonal $\mathbf{S}$ matrices contain combined survival, fertility, and migration probabilities while the off-diagonal $\mathbf{M}$ matrices contain the probabilities of each age-group moving from one region to the other.

In practice, we create these matrices by multiplying a migration matrix, $\mathbf{M}$, which contains the probability of migrating from the $ith$ region to the $jth$ region in the diagonal by the $\mathbf{S}$ matrix above. In this example, 15% of age group 2 from region $i$ moves to region $j$.


\begin{equation}
\mathbf{MS_{t}} =
\begin{bmatrix}
\begin{array}{c|c}

\begin{matrix} 0 & 0.2 & 0.2 \\ 0.62 & 0 & 0 \\ 0 & 0.35 & 0.35 \end{matrix} &
\begin{matrix} 0 & 0 & 0 \\ 0 & 0 & 0 \\ 0 & 0 & 0 \end{matrix} \\
\hline
\begin{matrix} 0 & 0 & 0 \\ 0 & 0 & 0 \\ 0 & 0 & 0 \end{matrix} &
\begin{matrix} 0 & 0.2 & 0.2 \\ 0.67 & 0 & 0 \\ 0 & 0.33 & 0.33 \end{matrix} \\
\end{array}
\end{bmatrix}
\cdot
\begin{bmatrix}
\begin{array}{c|c}

\begin{matrix} 1 & 0 & 0 \\ 0 & 0.85 & 0 \\ 0 & 0 & 1 \end{matrix} &
\begin{matrix} 0 & 0 & 0 \\ 0 & 0 & 0 \\ 0 & 0 & 0 \end{matrix} \\
\hline
\begin{matrix} 0 & 0 & 0 \\ 0 & 0.15 & 0 \\ 0 & 0 & 0 \end{matrix} &
\begin{matrix} 1 & 0 & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 1 \end{matrix} \\
\end{array}
\end{bmatrix}
=
\end{equation}

\begin{equation}
\begin{bmatrix}
\begin{array}{c|c}

\begin{matrix} 0 & 0.2 & 0.2 \\ 0.527 & 0 & 0 \\ 0 & 0.35 & 0.35 \end{matrix} &
\begin{matrix} 0 & 0 & 0 \\ 0 & 0 & 0 \\ 0 & 0 & 0 \end{matrix} \\
\hline
\begin{matrix} 0 & 0 & 0 \\ 0.093 & 0 & 0 \\ 0 & 0 & 0 \end{matrix} &
\begin{matrix} 0 & 0.2 & 0.2 \\ 0.67 & 0 & 0 \\ 0 & 0.33 & 0.33 \end{matrix} \\
\end{array}
\end{bmatrix}
\end{equation}

Where the migration rate from $i$ to $j$ in age group 2 is 0.15.

### Data

We populate our Leslie matrices with the 3,143 US counties, 18 five-year age groups, and two sex groups. We use CCRs to populate our $S$ values in each matrix and child-woman ratios to populate our $F$ values. The values come from the NVSS Bridged Race Categories. To project the CCRs, We employ an autoregressive integrated moving average (ARIMA) model for forecasting equally spaced univariate time series data. We use an `ARIMA(0,1,1)` model, which produces forecasts equivalent to simple exponential smoothing. All projections were undertaken in **R** [@rcore] using the `forecast` package [@Rforecast].

Where an `r paste0(arma)` model is


\begin{eqnarray}\label{eq:ARIMA}
Y_t & = & Y\_{t-1} + e_t - \theta e_{t-1} \\
\hat{Y}_{t+1} & = & Y_t - \theta e_{t-1}
\end{eqnarray}

where $e_t$ is independent and identically distributed as $N(0,\sigma_e^2)$. It can be shown that $\hat{Y}_{t+1}$ is an exponentially weighted moving average of the observations $Y_t, Y_{t-1},...$ with weights $\theta_1^k(1-\theta_1)k=0,1,...,$ and that the additional forecasts $\hat{Y}_{t+j}$ for $j>1$ remain constant at $\hat{Y}_{t+1}$ [@box2008time, p.158].

#### Migration

We also calculate the probability of migrating from each county to each county. These data come from the IRS county-to-county migration files from 1990-2018 (see @hauer2019irs and @dewaard2021user for descriptions of this data). The IRS began using tax data to estimate migration in the 1970s and 1980s [@engels1981measuring; @franklin2006pandora] and began releasing migration data in 1990. The IRS uses individual federal tax returns, matches these individual returns between two tax years (for instance, tax year 2000 and tax year 2001), and identifies both migrants and non-migrants. Beginning with the tax year 1991 (the migration year 1990), the IRS produces these data in conjunction with the US Census Bureau using the IRS Individual Master File, which contains every Form 1040, 1040A, and 1040EZ [@gross2005internal]. We identify migration when a current years' tax form contains an address different from the preceding years' return. A non-migrant is identified when there is no change in address between two years. For the 2002 tax year, the IRS migration data contained approximately 130 million returns [@gross2005internal].

The annual series of county-to-county migration data cover 95 to 98 percent of the tax-filing universe (or approximately 87% of US households [@molloy2011internal]) and their dependents making these data the largest migration data source for count flows between counties in the United States. The IRS derives migration information from tax-filings making those who do not file taxes most likely to be underrepresented in the migration data [@gross2005internal; @dewaard2016population], namely undocumented populations, the poor, the elderly, and college students [@gross2005internal]. However, the overwhelming majority of householders file US tax returns in the United States [@molloy2011internal].

To capture changes in the migration system, we employ an ETS model (Error, Trend, Seasonal), a univariate time series forecasting model [@hyndman2008forecasting]. We use an ETS model for migration instead of an ARIMA(0,1,1) as we do for the CCRs because the CCRs are subject to multiplication during a drift, whereas the migration system is not. A CCR that drifts from 1.1 $\rightarrow$ 1.3 represents more than a 10-fold increase in a projected population over our time horizons (1.1\^17 = 5x, 1.3\^17 = 86x). Projecting the migration system itself is not subject to such exponential drift.

We fit individual ETS models for each county's numeric migrants between each origin-destination dyadic pair using the `forecast` package in R [@Rforecast]. This approach allows the underlying migration system to evolve and change over the projection horizon, allowing dyadic pairs to wax or wane.The model converts the numeric projections to fractions of the total projected migrants to populate the diagonal in the $\mathbf{M}$ matrix above where non-migrants (i.e. those migrating from $i\rightarrow i$) are included. The result is the fraction of individuals surviving from age group $a$ who migrate from $i\rightarrow j$.

## Sea-level Rise Exposure

To estimate the populations at-risk to SLR and thus likely migrants, we employ the inundation modeling [@hauer2020sea] which assumes that people who are underwater 100% of the time must migrate. We estimate these populations using airborne lidar-derived digital elevation models (DEMs) produced by NOAA and supplemented with both the USGS Northern Gulf of Mexico Topobathymetric DEM in Louisiana and the USGS National Elevation Dataset in the fraction of land not covered by other sources (see @kulp2019new for details on the construction of the DEMs).

Using a bathtub model of inundation, we calculate the land area under a given water height to generate binary inundation surfaces. SLR exposure is hyperlocalized, and we generate this inundation area in the Census Block Groups (CBG; n=81,815) located in coastal counties (n=406) expected to experience any probability of flooding. We use probabilistic SLR projections [@sweetGlobalRegionalSea2017] that are closely aligned with the IPCC for our water heights. To calculate the land area under a given water height, we simply threshold the DEM to find pixels below $SLR_{yt}$ where $y$ is the projected height of SLR in a given year $t$. For each CBG, we simply calculate the percentage of its pixels on dry land (defined in the National Wetland Inventory [@WetlandInventory]) covered by the inundation surface and multiply this percentage by the total population in the CBG in 2010 to produce the total number of people at-risk to a given amount of SLR in a given year. We then aggregate these CBGs to the county-level to calculate the percentage of people in a given county at-risk of inundation.

The percentage of the population at-risk to SLR in each county, in essence, represents the $\Delta P_t$ from our equations above where $\Delta P_t = \hat{P_t}/P_t$. In this case, $\hat{P_t}/P_t$ is the percentage of the population in any county at-risk of inundation. Such a calculation allows us to seamlessly combine our parsimonious displacement model with our matrix population model.

## Full Model

Our full model uses a multiregional leslie matrix with the dimensions 3143 counties, 18 five-year age groups, and two sex groups.

Recall that in a typical leslie matrix $\mathbf{P_{t+1}} = \mathbf{S_t}\mathbf{P_t}$ and a multiregional leslie matrix is $\mathbf{P_{t+1}} = \mathbf{M_t}\mathbf{S_t}\mathbf{P_t}$ where $\mathbf{S_t}$ contains the age-sex specific probabilities of surviving and fertility information and $\mathbf{M_t}$ contains the probability of migrating between regions. Since our survival probabilities in $\mathbf{S_t}$ are comprised of cohort-change ratios and our displacement model generates alterations in CCRs, we can specifify three different sets of demographic projections: a projection without incorporating climate migration, a projection incorporating climate migration, and a projection incorporating simple displacement.

A simple demographic projection simply uses the specifications of the leslie matrix laid out in \autoref{eq:lesliematrix_base}. This produces a set of demographic projections without accounting for climate migration. We refer to this projection as the *"base projection."*

We also generate a second, simple projection that incorporates simple displacement. Many climate migration models employ simple displacement models, and we recreate those models here. We produce this by simply multiplying the total projected population at time step $t$ in each county by the percentage of the population expected to be inundated at each time step. This allows us to evaluate how our integrated models compare to existing approaches in the literature. We refer to this projection as the *"inundation projection."*

Finally, we produce an integrated population projection which we refer to as the *migration projection*. We produce this projection in several steps, but the full specification is

$$
\mathbf{P_{t+1}} = \underbrace{\underbrace{\mathbf{M_t}(\mathbf{\hat{S_t}}\mathbf{P_t} - \overbrace{\mathbf{S_t}\mathbf{P_t}}^{Base})}_{Inundation} + \mathbf{\hat{S_t}}\mathbf{P_t}}_{Migration}
$$

Where $\mathbf{M_t}$ is the matrix containing the probabilities of migrating from county $i$ to county $j$, $\mathbf{\hat{S_t}}$ contains the survival probabilities for each age group $a$ for each county $c$ for each time period $t$ that is reduced following \autoref{eq:predCCR}. In this case, $h$ is the percentage of the population at-risk to SLR. $\mathbf{S_t}$ is the matrix containing the unreduced, or base, survival probabilities.

Essentially, we populate the $S_{act}$ in matrix $\mathbf{\hat{S_t}}$ or the survival probabilities for each age group $a$ for each county $c$ for each time period $t$ using \autoref{eq:predCCR}.We calculate $\hat{CCR_{act}}$ using the percentage of the population at-risk to SLR as the $h$ value. This produces a second set of survival probabilities that are reduced based on SLR and we populate a new leslimatrix ($\mathbf{\hat{S_t}}$) with these new reduced survival probailities ($\hat{S_{act}}$). The difference between the projected population using $\mathbf{\hat{S_t}}$ and using $\mathbf{S_t}$ ($\mathbf{D_t}=\mathbf{\hat{S_t}}\mathbf{P_t} - \mathbf{S_t}\mathbf{P_t}$, where $\mathbf{D_t}$ is the displaced population) represents the anticipated number of people who are inundated by SLR and thus likely to migrate. We then multiply the migration matrix $\mathbf{M_t}$ by the displaced population to produce the number of people migrating between counties by age-sex group. Finally, we simply add these migrants back into the projected population produced with $\mathbf{\hat{S_t}}$.

# Results


```{r FigProjLines, echo= FALSE, message = FALSE, warning = FALSE, fig.cap= paste("\\textbf{A comparison of base, inundation, and migration projections for four sample counties over the next century with 3ft of SLR.} The inundation model projection refines the previous base model as it accounts for sea-level rise displacement. Including demographic processes further sophisticates the migration projection. In the case of these example counties, the migration model reflects both those who emigrated and their lost progeny, indicating a substantial decline in the projected population for 2100 as compared to the base model population. \\label{MiamiDadeFigure}")}

```


```{r include=FALSE}
projsums<-read_csv("../R/DATA-PROCESSED/PROJECTIONS/projections_TOT.csv")
# 
cnty <- "12086"
proj_cnty <- projsums[which(projsums$GEOID == cnty),]
```

Here we show preliminary, selected results assuming 3 feet of SLR by 2100. \autoref{MiamiDadeFigure} shows comparative results for Miami-Dade County. We compare three separate projection models. Our `Base` model shows a population projection without accounting for climate-migration. Without accounting for climate-migration, we would project Miami-Dade's population to increase from `r label_number_si(accuracy=0.1)(proj_cnty$mean_base[which(proj_cnty$YEAR==2020)])` in 2020 to `r label_number_si(accuracy=0.1)(proj_cnty$mean_base[which(proj_cnty$YEAR==2100)])` in 2100. Using a simple displacement model (labelled as `Inundation` in the figure), we would project the 2100 population to be `r label_number_si(accuracy=0.1)(proj_cnty$mean_inun[which(proj_cnty$YEAR==2100)])` -- a decrease of `r label_number_si(accuracy=1)(proj_cnty$mean_base[which(proj_cnty$YEAR==2100)] - proj_cnty$mean_inun[which(proj_cnty$YEAR==2100)])` people, reflecting a direct displacement of nearly a quarter of a million people by 2100 with 3ft of SLR. However, this type of simple displacement model is relatively common in the prospective modeling literature concerning climate migration but does not account for underlying population dynamics.

Our third model, labeled `Migration`, accounts for underlying demographic processes. In this model, climate migrants are able to reproduce, have children, move to other areas, experience mortality, etc. Under our `Migration` model, we project Miami-Dade's population to be `r label_number_si(accuracy=0.1)(proj_cnty$mean_mig[which(proj_cnty$YEAR==2100)])` in 2100 -- a major decrease of `r label_number_si(accuracy=0.1)(proj_cnty$mean_base[which(proj_cnty$YEAR==2100)] - proj_cnty$mean_mig[which(proj_cnty$YEAR==2100)])`. Here, when accounting for population dynamics, the actual population change becomes considerably larger than the simple displacement models in the climate migration literature.

```{r CountyMap, echo= FALSE, message = FALSE, warning = FALSE,out.width="\\textwidth",fig.cap= paste("\\textbf{Projected Changes in US County populations between the `Base' and `Migration' projections with 3 feet of SLR.} The numeric difference between population projections without accounting for climate migration and accounting for climate migration. Counties without climate migrants depicted in gray. Accounting for climate migration shifts many people throughout the US. \\label{CountyMapFigure}")}
# knitr::include_graphics("../countymap.pdf")

projsums <- read_csv("../R/DATA-PROCESSED/PROJECTIONS/projections_TOT.csv") %>%
  filter(YEAR == 2100) %>%
  mutate(dif = mean_mig - mean_base,
         rel = dif / mean_base) %>%
  mutate(dif = ifelse(dif == 0 , NA, dif),
         rel = ifelse(rel == 0, NA, rel))

## Getting the natural breaks and then slightly alterting them
# getJenksBreaks(projsums$dif, k = 8)
# getJenksBreaks(projsums$rel, k = 8)
breaksdif <- c(-Inf, -500000, -150000, -25000, 0, 15000, 35000, 100000, Inf)
breaksrel <- c(-Inf, -0.5, -0.20, -0.05, 0, 0.05, 0.15, 0.5, Inf)
projsums$groups_dif <- factor(
  cut(projsums$dif, breaksdif),
  labels = c("< -500K", "-499K to -150K", "-149K to -25K", "-24K to -1", "1 to 15K",
  "16K to 35K", "35K to 100K", "100K+"))
projsums$groups_rel <- factor(
  cut(projsums$rel, breaksrel),
  labels = c("< -50%", "-50% to -20%", "-20% to -5%", "-5% to -1%", "1% to 5%",
             "5% to 15%", "15% to 50%", "50%+"))

mapdat <- get_acs("county",
                  "B19013_001",
                  geometry=TRUE,
                  shift_geo=TRUE) %>%
  left_join(., projsums)



states <- get_acs("state",
                  "B19013_001",
                  geometry=TRUE,
                  shift_geo=TRUE)
addSmallLegend <- function(myPlot, pointSize = 2, textSize = 8, spaceLegend = 1) {
    myPlot +
        guides(shape = guide_legend(override.aes = list(size = pointSize)),
               color = guide_legend(override.aes = list(size = pointSize))) +
        theme(legend.title = element_text(size = textSize),
              legend.text  = element_text(size = textSize),
              legend.key.size = unit(spaceLegend, "lines"))
}
a<- ggplot(mapdat, aes(fill=groups_dif)) +
  geom_sf() +
  scale_fill_brewer(type = "div", palette = "RdYlBu", na.value="grey50") +
  geom_sf(data=states, aes(fill=NULL),alpha=0, color="black") +
  coord_sf(datum = NA) +
  theme_bw() +
  theme(legend.direction="horizontal") +
  theme(legend.position = c(0.7, 0.05)) +
  labs(fill = "Difference")
addSmallLegend(a, pointSize = 1.5, textSize = 6, spaceLegend = 0.5)

```

A basic displacement model suggests 3ft of SLR will displace `r label_number_si(accuracy=0.1)(sum(projsums$mean_base) - sum(projsums$mean_inun))` people. In this simple model, the demographic impact of SLR is `r label_number_si(accuracy=0.1)(sum(projsums$mean_base) - sum(projsums$mean_inun))` people migrating to other places for a net demographic change of just `r label_number_si(accuracy=0.1)(sum(projsums$mean_base) - sum(projsums$mean_inun))` people. However, when one accounts for population dynamics, the actual demographic impact of `r label_number_si(accuracy=0.1)(sum(projsums$mean_base) - sum(projsums$mean_inun))` people on the move is `r label_number_si(accuracy=0.01)(sum(projsums$diff[which(projsums$YEAR==2100) & projsums$diff>0]))` (**\autoref{CountyMapFigure}**). This is because of the population momentum that we expect to occur due to the interacting effects of basic demographic component processes of migration, fertility, and mortality. Most surprising is that this demographic effect is considerably more pronounced than the simple displacement effect. In fact, it is nearly 4x larger!


```{r MedAge, echo= FALSE, message = FALSE, warning = FALSE, out.width="\\textwidth", fig.cap= paste("\\textbf{Projected Changes in US County populations between the `Base' and `Migration' projections with 3 feet of SLR.} The numeric difference between population projections without accounting for climate migration and accounting for climate migration. Counties without climate migrants depicted in gray. Accounting for climate migration shifts many people throughout the US. \\label{FigureAging}")}


```
